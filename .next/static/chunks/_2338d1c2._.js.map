{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/divya/OneDrive/Desktop/Developers/hackernews-frontend-final/app/%5Bid%5D/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useState,useCallback } from \"react\";\r\nimport { useParams } from \"next/navigation\";\r\n\r\ntype Post = {\r\n  id: string;\r\n  title: string;\r\n  content: string;\r\n  createdAt: string;\r\n};\r\n\r\ntype Comment = {\r\n  id: string;\r\n  content: string;\r\n  createdAt: string;\r\n  userId: string;\r\n};\r\n\r\nexport default function PostDetailPage() {\r\n  const { id } = useParams();\r\n  const [post, setPost] = useState<Post | null>(null);\r\n  const [comments, setComments] = useState<Comment[]>([]);\r\n  const [newComment, setNewComment] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [likesCount, setLikesCount] = useState(0);\r\n  const [liked, setLiked] = useState(false);\r\n  const [currentUserId, setCurrentUserId] = useState<string | null>(null);\r\n  const [editingCommentId, setEditingCommentId] = useState<string | null>(null);\r\n  const [editedContent, setEditedContent] = useState(\"\");\r\n  const API_BASE = process.env.NEXT_PUBLIC_API_BASE_URL;\r\n\r\n  const fetchCurrentUser = useCallback(async () => {\r\n    try {\r\n      const res = await fetch(`${API_BASE}/api/auth/user`, {\r\n        credentials: \"include\",\r\n      });\r\n      if (res.ok) {\r\n        const user = await res.json();\r\n        setCurrentUserId(user.id);\r\n      }\r\n    } catch {\r\n      console.error(\"Failed to fetch current user\");\r\n    }\r\n  },[API_BASE]);\r\n\r\n  const fetchPost = useCallback(async () => {\r\n    try {\r\n      const res = await fetch(`${API_BASE}/posts/getpost/${id}`, {\r\n        credentials: \"include\",\r\n      });\r\n      if (!res.ok) throw new Error(\"Failed to fetch post\");\r\n      const json = await res.json();\r\n      setPost(json.data);\r\n    } catch {\r\n      setError(\"Could not load the post\");\r\n    }\r\n  },[API_BASE,id]);\r\n\r\n  const fetchComments = useCallback(async () => {\r\n    try {\r\n      const res = await fetch(`${API_BASE}/comments/on/${id}`, {\r\n        credentials: \"include\",\r\n      });\r\n      const json = await res.json();\r\n      setComments(json.data || []);\r\n    } catch {\r\n      console.error(\"Failed to fetch comments\");\r\n    }\r\n  },[API_BASE,id]);\r\n\r\n  const fetchLikes = useCallback(async () => {\r\n    try {\r\n      const res = await fetch(`${API_BASE}/likes/on/${id}`, {\r\n        credentials: \"include\",\r\n      });\r\n      const json = await res.json();\r\n      setLikesCount(json.total || 0);\r\n      setLiked(json.alreadyLiked);\r\n    } catch {\r\n      console.error(\"Failed to fetch likes\");\r\n    }\r\n  },[API_BASE,id]);\r\n\r\n  const handleAddComment = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!newComment.trim()) return;\r\n\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(`${API_BASE}/comments/on/${id}`, {\r\n        method: \"POST\",\r\n        credentials: \"include\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({ content: newComment }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const errorBody = await res.text();\r\n        console.error(\"Error adding comment:\", res.status, errorBody);\r\n        throw new Error(\"Failed to add comment\");\r\n      }\r\n\r\n      setNewComment(\"\");\r\n      fetchComments();\r\n    } catch {\r\n      console.error(\"Error adding comment\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (commentId: string) => {\r\n    if (!confirm(\"Are you sure you want to delete this comment?\")) return;\r\n    try {\r\n      const res = await fetch(`${API_BASE}/comments/${commentId}`, {\r\n        method: \"DELETE\",\r\n        credentials: \"include\",\r\n      });\r\n      if (res.ok) {\r\n        fetchComments();\r\n      } else {\r\n        const err = await res.json();\r\n        alert(err.message || \"Failed to delete comment\");\r\n      }\r\n    } catch {\r\n      alert(\"Error deleting comment\");\r\n    }\r\n  };\r\n\r\n  const handleUpdate = async (commentId: string) => {\r\n    try {\r\n      const res = await fetch(`${API_BASE}/comments/${commentId}`, {\r\n        method: \"PATCH\",\r\n        credentials: \"include\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({ content: editedContent }),\r\n      });\r\n\r\n      if (res.ok) {\r\n        fetchComments();\r\n        setEditingCommentId(null);\r\n      } else {\r\n        const err = await res.json();\r\n        alert(err.message || \"Failed to update comment\");\r\n      }\r\n    } catch {\r\n      alert(\"Error updating comment\");\r\n    }\r\n  };\r\n\r\n  const handleLike = async () => {\r\n    try {\r\n      const res = await fetch(`${API_BASE}/likes/on/${id}`, {\r\n        method: \"POST\",\r\n        credentials: \"include\",\r\n      });\r\n\r\n      if (res.ok) {\r\n        setLiked(true);\r\n        setLikesCount((prev) => prev + 1);\r\n      } else {\r\n        const err = await res.json();\r\n        alert(err.message || \"Failed to like post\");\r\n      }\r\n    } catch {\r\n      alert(\"Error liking post\");\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (id) {\r\n      fetchCurrentUser();\r\n      fetchPost();\r\n      fetchComments();\r\n      fetchLikes();\r\n    }\r\n  }, [id,fetchComments,fetchCurrentUser,fetchLikes,fetchPost]);\r\n\r\n  if (error) return <p className=\"text-red-600 p-4\">{error}</p>;\r\n  if (!post) return <p className=\"p-4\">Loading...</p>;\r\n\r\n  return (\r\n    <main className=\"bg-[#f6f6ef] min-h-screen p-4 text-[13px] text-black max-w-2xl mx-auto mt-15\">\r\n      <div className=\"flex items-start gap-2 mb-2\">\r\n        {!liked && (\r\n          <button onClick={handleLike} className=\"text-orange-600 hover:text-orange-700 select-none\">\r\n            â–²\r\n          </button>\r\n        )}\r\n        <h1 className=\"text-[15px] font-medium leading-tight\">\r\n          {post.title}\r\n        </h1>\r\n      </div>\r\n\r\n      <div className=\"text-gray-600 text-xs mb-4\">\r\n        {likesCount} {likesCount === 1 ? \"point\" : \"points\"} | posted {new Date(post.createdAt).toLocaleDateString()} \r\n      </div>\r\n\r\n      <p className=\"mb-8 text-[13px] text-gray-800\">{post.content}</p>\r\n\r\n      <form onSubmit={handleAddComment} className=\"mb-8\">\r\n        <textarea\r\n          value={newComment}\r\n          onChange={(e) => setNewComment(e.target.value)}\r\n          rows={3}\r\n          className=\"w-full border border-gray-300 p-2 rounded focus:outline-none focus:ring-2 focus:ring-orange-400 text-[13px]\"\r\n          placeholder=\"Write a comment...\"\r\n        />\r\n        <div className=\"mt-2\">\r\n          <button\r\n            type=\"submit\"\r\n            disabled={loading}\r\n            className=\"text-white bg-orange-500 hover:bg-orange-600 px-4 py-1 rounded text-[13px]\"\r\n          >\r\n            {loading ? \"Adding...\" : \"Add Comment\"}\r\n          </button>\r\n        </div>\r\n      </form>\r\n\r\n      <section>\r\n        <h2 className=\"text-[14px] font-semibold mb-3\">Comments</h2>\r\n        {comments.length === 0 ? (\r\n          <p className=\"text-gray-500\">No comments yet.</p>\r\n        ) : (\r\n          <ul className=\"space-y-4\">\r\n            {comments.map((comment) => (\r\n              <li key={comment.id} className=\"ml-4 text-[13px]\">\r\n                {editingCommentId === comment.id ? (\r\n                  <>\r\n                    <textarea\r\n                      className=\"w-full border p-1\"\r\n                      value={editedContent}\r\n                      onChange={(e) => setEditedContent(e.target.value)}\r\n                    />\r\n                    <div className=\"flex gap-2 text-xs mt-1\">\r\n                      <button\r\n                        onClick={() => handleUpdate(comment.id)}\r\n                        className=\"text-green-600\"\r\n                      >\r\n                        Save\r\n                      </button>\r\n                      <button\r\n                        onClick={() => setEditingCommentId(null)}\r\n                        className=\"text-red-600\"\r\n                      >\r\n                        Cancel\r\n                      </button>\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <p>{comment.content}</p>\r\n                    <p className=\"text-gray-400 text-xs\">\r\n                      {new Date(comment.createdAt).toLocaleString()}\r\n                    </p>\r\n\r\n                    {comment.userId === currentUserId && (\r\n                      <div className=\"flex gap-3 text-blue-600 text-xs mt-1\">\r\n                        <button\r\n                          onClick={() => {\r\n                            setEditingCommentId(comment.id);\r\n                            setEditedContent(comment.content);\r\n                          }}\r\n                        >\r\n                          Edit\r\n                        </button>\r\n                        <button onClick={() => handleDelete(comment.id)}>Delete</button>\r\n                      </div>\r\n                    )}\r\n                  </>\r\n                )}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        )}\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 452, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/divya/OneDrive/Desktop/Developers/hackernews-frontend-final/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0],"debugId":null}}]
}